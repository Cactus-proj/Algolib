# Copyright (C) 1991--2010 by INRIA.
#
# This file is part of Algolib.
#
# Algolib is free software: you can redistribute it and/or modify it
# under the terms of the GNU Lesser General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.
#
# Algolib is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with Algolib.  If not, see
# <http://www.gnu.org/licenses/>.

# The ratio, -1 or +1, is set as a side-effect.
cmp := proc(e1, e2) global ratio ;
  ratio := normal(e1/e2) ;
  evalb(member(ratio, {-1, +1}))
end proc :
with(Mgfun) :
f := (x+y^4)/(x+y^2+1)^2 :

CT := creative_telescoping(f, x::diff, y::diff)[1] :
if cmp(CT[1], (-7*x-1-3*x^2)*_F(x)+(16*x^2+16*x+6+6*x^3)*diff(_F(x), x))
then okay else "CT.1", CT end if ;

RCT := rational_creative_telescoping(f, x::diff, y::diff) :
if cmp(RCT[1], CT[1]) then okay else "RCT.1", RCT end if ;
if diff( normal(eval(CT[2], _f(x,y)=f) - ratio*RCT[2]), y ) = 0
then okay else "RCT.2", RCT end if ;

RCTu := rational_creative_telescoping(f, x::diff, y::diff, normalized=false) :
if cmp(RCTu[1], CT[1]) then okay else "RCTu.1", RCTu end if ;
if diff( normal(eval(CT[2], _f(x,y)=f) - ratio*RCTu[2]), y ) = 0
then okay else "RCTu.2", RCTu end if ;
